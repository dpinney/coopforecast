{% extends 'base-and-nav.html' %}

{% block title %}{{ title }}{% endblock %}
{% block head %}{% endblock %}

{% block content %}
{% include 'partials/messages.html' %}

<h1>{{ title }}</h1>
<ul>
  <li><a href="#upload">Upload Data</a></li>
  <li><a href="#chart">Chart</a></li>
  <li><a href="#table">Table</a></li>
</ul>

<div class="card shadow mb-4" id="upload">
  <div class="card-header py-3">
    <h6 class="m-0 font-weight-bold text-primary">Upload Data</h6>
  </div>
  <div class="card-body">
    <p>
      <a href="{{ instructions }}" class="btn btn-secondary btn-sm">Read data upload instructions</a>
      <a href="{{ gist_example }}" class="btn btn-secondary btn-sm">View an example dataset</a>
    </p>

    <div class="input-group mb-3">
      <form method=post enctype=multipart/form-data>
        <input type=file name=file>
        <input type=submit value=Upload>
      </form>
    </div>

    {% if sync_request %}
    <hr>
    <form action="/{{ name }}/sync" method="POST">
      <input type=submit value="Sync data with {{ sync_request }}">
    </form>
    {% endif %}
  </div>
</div>

{% if chart %}
<div class="card shadow mb-4" id="chart">
  <!-- Card Header - Accordion -->
  <a href="#collapse-chart" class="d-block card-header py-3" data-toggle="collapse" role="button" aria-expanded="true"
    aria-controls="collapse-chart">
    <h6 class="m-0 font-weight-bold text-primary">Charts</h6>
  </a>
  <!-- Card Content - Collapse -->
  <div class="collapse show" id="collapse-chart">
    <div class="card-body">
      <div id="chart-container" style="height: 400px; min-width: 310px"></div>
      <script type="text/javascript">
        create_timeseries_chart(id = 'chart-container', data = {{ chart | tojson }}, title = '{{ title }}', series_name = '{{ view_key }}')
      </script>
    </div>
  </div>
</div>
{% else %}

{# Show message when no data exists #}

<div class="card shadow mb-4" id="upload">
  <div class="card-body text-center ">
    No data currently uploaded. Data will display here after uploading a CSV.
  </div>
</div>

{% endif %}

{% if table %}
{% if hide_table %}
<div class="card shadow mb-4" id="table">
  <!-- Card Header - Accordion -->
  <a href="#collapse-table" class="d-block card-header py-3" data-toggle="collapse" role="button" aria-expanded="true"
    aria-controls="collapse-table">
    <h6 class="m-0 font-weight-bold text-primary">Tables</h6>
  </a>
  <!-- Card Content - Collapse -->
  <div class="collapse show" id="collapse-table">
    <div class="card-body">
      <p id="table-warning">This table has been hidden since it is very large and may slow down your webpage. If you're
        looking to further inspect your data, it may be more convenient to click on the menu in the chart above and
        click on the "Download CSV" prompt.
      </p>

      <p>
        <button id="table-button" class="btn-secondary btn-sm" onclick="toggle_table_visibility()">Show Table</button>
      </p>

      {% include 'partials/table.html' %}
    </div>
  </div>
</div>
{% else %}
<div class="card shadow mb-4" id="table">
  <!-- Card Header - Accordion -->
  <a href="#collapse-table" class="d-block card-header py-3" data-toggle="collapse" role="button" aria-expanded="true"
    aria-controls="collapse-table">
    <h6 class="m-0 font-weight-bold text-primary">Table</h6>
  </a>
  <!-- Card Content - Collapse -->
  <div class="collapse show" id="collapse-table">
    <div class="card-body">
      <h3>Forecast Data</h3>
      {% include 'partials/table.html' %}
    </div>
  </div>
</div>
{% endif %}
{% endif %}

{% endblock %}