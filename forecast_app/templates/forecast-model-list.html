{% extends 'base-and-nav.html' %}

{% block title %}Forecast Weather Data{% endblock %}
{% block head %}{% endblock %}

{% block content %}

<h1>Forecast Models</h1>

{% include 'partials/messages.html' %}

<div class="card shadow mb-4" id="upload">
  <div class="card-header py-3">
    <h6 class="m-0 font-weight-bold text-primary">Manage Models</h6>
  </div>
  <div class="card-body">
    <div>
      {% if hd_is_prepared %}
      <p>Historical data is prepared from <b class="text-primary">{{ hd_start_date.strftime('%b %d, %Y %H:%M')
          }}</b> to <b class="text-primary">{{ hd_end_date.strftime('%b %d, %Y %H:%M') }}</b>.</p>
      {% else %}
      <p>Historical data is not prepared. Check that data is uploaded to both <a
          href="{{ url_for('historical-load-data') }}">Load
          Data</a>
        and <a href="{{ url_for('historical-weather-data') }}">Historical Weather Data</a>.</p>
      {% endif %}

      {% if fd_is_prepared %}
      <p>Forecast data is prepared from <b class="text-primary">{{ fd_start_date.strftime('%b %d, %Y %H:%M') }}</b>
        to <b class="text-primary">{{ fd_end_date.strftime('%b %d, %Y %H:%M') }}</b>.</p>
      {% else %}
      <p>Forecast data is not prepared. Check that data is uploaded to <a
          href="{{ url_for('forecast-weather-data')}}">Forecast Weather Data</a>.</p>
      {% endif %}

      {% if model_is_prepared %}
      <hr>
      <p>A new model would be generated from <b class="text-primary">{{
          model_start_date.strftime('%b %d, %Y %H:%M') }}</b> to <b class="text-primary">
          {{ model_end_date.strftime('%b %d, %Y %H:%M') }}</b>
      </p>
      {% else %}
      <p>
        Insufficient data has been provided to launch a new model. Please ensure that the proper load and temperature
        data has been uploaded.
      </p>
      {% endif %}
    </div>

    {% if model_is_prepared %}
    <form action="{{ url_for('latest-forecast') }}" method="post" id="runModel"></form>
    <div style="display: flex; justify-content: space-between;">
      <div>
        <a onclick="document.forms['runModel'].submit(); return false;" class="btn btn-primary btn-icon-split">
          <span class="icon text-white-600">
            <i class="fas fa-arrow-right"></i>
          </span>
          <span class="text">Generate new model</span>
        </a>
      </div>
      <form action="" method="post" id="cancelAllModels"></form>
      <div>
        <a onclick="document.forms['cancelAllModels'].submit(); return false;" class="btn btn-danger btn-icon-split">
          <span class="icon text-white-600">
            <i class="fas fa-arrow-right"></i>
          </span>
          <span class="text">Cancel running models</span>
        </a>
      </div>
    </div>
  </div>
  {% endif %}
</div>

{% for model in models %}
<div class="card shadow mb-4" id="upload-forecast">
  <div class="card-header py-3">

    <h6 class="m-0 font-weight-bold text-primary"><a href="/forecast-models/{{ model.slug }}">MODEL: {{
        model.creation_date.timestamp() }}</a> {% include
      'partials/status.html' %}</h6>
    <div><b>Created:</b> {{ model.creation_date.strftime('%Y-%m-%d %H:%M:%S') }} </div>
    <div><b>Forecast:</b> <b class="text-primary">{{ model.start_date.strftime('%b %d, %Y %H:%M') }}</b> to <b
        class="text-primary">{{ model.end_date.strftime('%b %d, %Y %H:%M') }}</b></div>
  </div>
</div>


{% endfor %}

{% endblock %}